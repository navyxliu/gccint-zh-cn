<html lang="zh">
<head>
<title>gcov测试 - GNU Compiler Collection (GCC) Internals</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Compiler Collection (GCC) Internals">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="_00e6_00b5_008b_00e8_00af_0095_00e5_008c_0085.html#g_t_00e6_00b5_008b_00e8_00af_0095_00e5_008c_0085" title="测试包">
<link rel="prev" href="libgcj_00e6_00b5_008b_00e8_00af_0095.html#libgcj_00e6_00b5_008b_00e8_00af_0095" title="libgcj测试">
<link rel="next" href="profopt_00e6_00b5_008b_00e8_00af_0095.html#profopt_00e6_00b5_008b_00e8_00af_0095" title="profopt测试">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
版权 (C) 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,
1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008 自由软件基金会

您可以依据自由软件基金会所发行的GNU自由文档授权1.2版本或者之后的任何版本，
对本文档进行复制，分发和/或修改；其中不可变章节为"资助自由软件"，封面文
字为 (a) (参见下面)，以及封底文字为 (b) (参见下面)。授权的副本要被包含在
标题为"GNU自由文档授权"的章节中。

(a) FSF的封面文字为：

     GNU 手册

(b) FSF的封底文字为：

     您可以自由复制和修改本GNU手册，如同GNU软件。由自由软件基金会所发行
     的副本用于为GNU开发筹集资金。-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="gcov%e6%b5%8b%e8%af%95"></a>
<a name="gcov_00e6_00b5_008b_00e8_00af_0095"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="profopt_00e6_00b5_008b_00e8_00af_0095.html#profopt_00e6_00b5_008b_00e8_00af_0095">profopt测试</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="libgcj_00e6_00b5_008b_00e8_00af_0095.html#libgcj_00e6_00b5_008b_00e8_00af_0095">libgcj测试</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="_00e6_00b5_008b_00e8_00af_0095_00e5_008c_0085.html#g_t_00e6_00b5_008b_00e8_00af_0095_00e5_008c_0085">测试包</a>
<hr>
</div>

<h4 class="subsection">6.4.6 对<samp><span class="command">gcov</span></samp>测试的支持</h4>

<p>expect文件<samp><span class="file">gcov.exp</span></samp>，
提供了对测试<samp><span class="command">gcov</span></samp>和检查分支profile是否产生预期值的语言无关的支持。
<samp><span class="command">gcov</span></samp>测试还依赖于<samp><span class="file">gcc.dg.exp</span></samp>的程序，来编译和运行测试程序。
一个典型的<samp><span class="command">gcov</span></samp>测试包含下列在注释中的DejaGnu命令：

<pre class="smallexample">     { dg-options "-fprofile-arcs -ftest-coverage" }
     { dg-do run { target native } }
     { dg-final { run-gcov sourcefile } }
</pre>
 <p>对<samp><span class="command">gcov</span></samp>输出的检测可以包括行数，分支百分比和调用返回百分比。
所有这些检测都由在测试源文件中注释里出现的命令来请求。
缺省情况下处理检测行数的命令。检测分支百分比和调用返回百分比的命令，
当<samp><span class="command">run-gcov</span></samp>命令具有相应的参数<code>branches</code>或<code>calls</code>时，
才会被处理。例如，下面指定了两者都检测，
同时还传给<samp><span class="command">gcov</span></samp>一个<samp><span class="option">-b</span></samp>：

<pre class="smallexample">     { dg-final { run-gcov branches calls { -b sourcefile } } }
</pre>
 <p>行数命令出现在注释中，其源行期望能获得指定的数，
并具有形式<code>count(</code><var>cnt</var><code>)</code>。
测试应该只检测对于任意体系结构都会得到同一数值的行数。

 <p>检测分支百分比（<code>branch</code>）和调用返回百分比（<code>returns</code>）的命令彼此很
相似。起始命令出现在将报告百分比的一个行范围的第一行或者之前，
结束命令跟在行范围之后。起始命令可以包括一个百分比列表，其为在范围内期望获得的。
范围由同种类型的下一个命令来终止。
命令<code>branch(end)</code>或<code>returns(end)</code>标记了范围的结束，
而不起是一个新的。例如：

<pre class="smallexample">     if (i &gt; 10 &amp;&amp; j &gt; i &amp;&amp; j &lt; 20)  /* <span class="roman">branch(27 50 75)</span> */
                                     /* <span class="roman">branch(end)</span> */
       foo (i, j);
</pre>
 <p>对于调用返回百分比，指定的值为调用报告返回的百分比。对于分支百分比，
值或者为期望的百分比，或者为100减去那个值，
因为分支的方向可以根据目标机或优化级别而不同。

 <p>并不是所有的分支和调用都需要被检测。
测试不应检测可能被优化掉的或者被断言指令替代的分支。
不要检测编译器插入的调用或者可能被inline或优化掉的。

 <p>单个测试可以检测行数，分支百分比和调用返回百分比的组合。
检测行数的命令必须出现在将会报告行数的行中，
但是检测分支百分比和调用返回百分比的命令，可以将报告的行括起来。

 </body></html>

