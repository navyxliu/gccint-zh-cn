<html lang="zh">
<head>
<title>Collect2 - GNU Compiler Collection (GCC) Internals</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Compiler Collection (GCC) Internals">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="prev" href="_00e7_0089_0087_00e6_00ae_00b5.html#g_t_00e7_0089_0087_00e6_00ae_00b5" title="片段">
<link rel="next" href="_00e5_00a4_00b4_00e6_0096_0087_00e4_00bb_00b6_00e7_009b_00ae_00e5_00bd_0095.html#g_t_00e5_00a4_00b4_00e6_0096_0087_00e4_00bb_00b6_00e7_009b_00ae_00e5_00bd_0095" title="头文件目录">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
版权 (C) 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,
1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008 自由软件基金会

您可以依据自由软件基金会所发行的GNU自由文档授权1.2版本或者之后的任何版本，
对本文档进行复制，分发和/或修改；其中不可变章节为"资助自由软件"，封面文
字为 (a) (参见下面)，以及封底文字为 (b) (参见下面)。授权的副本要被包含在
标题为"GNU自由文档授权"的章节中。

(a) FSF的封面文字为：

     GNU 手册

(b) FSF的封底文字为：

     您可以自由复制和修改本GNU手册，如同GNU软件。由自由软件基金会所发行
     的副本用于为GNU开发筹集资金。-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Collect2"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="_00e5_00a4_00b4_00e6_0096_0087_00e4_00bb_00b6_00e7_009b_00ae_00e5_00bd_0095.html#g_t_00e5_00a4_00b4_00e6_0096_0087_00e4_00bb_00b6_00e7_009b_00ae_00e5_00bd_0095">头文件目录</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="_00e7_0089_0087_00e6_00ae_00b5.html#g_t_00e7_0089_0087_00e6_00ae_00b5">片段</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="index.html#Top">Top</a>
<hr>
</div>

<h2 class="chapter">20 <code>collect2</code></h2>

<p>GCC使用叫做 <code>collect2</code> 的工具，在几乎所有的系统上，来安排在起始
时候调用不同的初始化函数。

 <p>程序 <code>collect2</code> 的工作方式是通过初次连接程序，并查找连接器输出
文件中的指示为构造函数的特定名字符号；如果找到，则会创建一个新的包含
这些符号的临时文件 &lsquo;<samp><span class="samp">.c</span></samp>&rsquo;，编译该文件，并再次连接程序。

 <p><a name="index-g_t_005f_005fmain-4772"></a><a name="index-constructors_002c-automatic-calls-4773"></a>实际调用构造者的是叫做 <code>__main</code> 的子程序，其在main函数体（假若
<code>main</code> 是由GNU CC编译的）的开始处被（自动的）调用。调用
<code>__main</code> 是必需的，即使当编译C代码，并允许将C和C++目标代码连接
一起时。如果使用了 <samp><span class="option">-nostdlib</span></samp>，则会得到对 <code>__main</code> 未解
决的引用(unresolved reference)这样的错误，这是因为它是定义在标准GCC库
中。将 <samp><span class="option">-lgcc</span></samp> 包含在编译器命令行的后面便可以解决这个引用。

 <p>程序 <code>collect2</code> 被作为 <code>ld</code> 安装在编译器过程所被安装的目录
下。当 <code>collect2</code> 需要找到 <em>真正的</em> <code>ld</code> 时，它会尝试
下面的文件名：

     <ul>
<li>编译器搜索目录下的 <samp><span class="file">real-ld</span></samp>。

     <li>环境变量 <code>PATH</code> 所列出的目录下的 <samp><span class="file">real-ld</span></samp>。

     <li>如果制定了配置宏 <code>REAL_LD_FILE_NAME</code> 则搜索该文件。

     <li>编译器搜索目录下的 <samp><span class="file">ld</span></samp>，除了能导致 <code>collect2</code> 递归执行自己
的以外。

     <li><code>PATH</code> 下的 <samp><span class="file">ld</span></samp>。
</ul>

 <p>“编译器搜索目录”是指的 <samp><span class="command">gcc</span></samp> 针对编译器过程所搜寻的全部目录。
这包括通过 <samp><span class="option">-B</span></samp> 制定的目录。

 <p>交叉编译器的搜寻方式有一些不同：

     <ul>
<li>编译器搜索目录下的 <samp><span class="file">real-ld</span></samp>。

     <li><code>PATH</code> 下的 <samp><var>target</var><span class="file">-real-ld</span></samp>。

     <li>如果制定了配置宏 <code>REAL_LD_FILE_NAME</code> 则搜索该文件。

     <li>编译器搜索目录下的 <samp><span class="file">ld</span></samp>。

     <li><code>PATH</code> 下的 <samp><var>target</var><span class="file">-ld</span></samp>。
</ul>

 <p><code>collect2</code> 显示的避免使用调用 <code>collect2</code> 的文件名来运行
<code>ld</code>。实际上，它记录了一个名字列表——以防一个 <code>collect2</code> 版本会
找到另一个版本的 <code>collect2</code>。

 <p><code>collect2</code> 使用上面针对 <code>ld</code> 的相同算法来搜寻工具 <code>nm</code> 和
<code>strip</code>。

<!-- Copyright (C) 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001 Free Software Foundation, Inc. -->
<!-- This is part of the GCC manual. -->
<!-- For copying conditions, see the file gcc.texi. -->
 </body></html>

