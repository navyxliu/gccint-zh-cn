<html lang="en">
<head>
<title>Type Information - GNU Compiler Collection (GCC) Internals</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Compiler Collection (GCC) Internals">
<meta name="generator" content="makeinfo 4.11">
<link title="Top" rel="start" href="index.html#Top">
<link rel="prev" href="Header-Dirs.html#Header-Dirs" title="Header Dirs">
<link rel="next" href="Funding.html#Funding" title="Funding">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,
1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007,
2008 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``Funding Free Software'', the Front-Cover
Texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.

(a) The FSF's Front-Cover Text is:

     A GNU Manual

(b) The FSF's Back-Cover Text is:

     You have freedom to copy and modify this GNU Manual, like GNU
     software.  Copies published by the Free Software Foundation raise
     funds for GNU development.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Type-Information"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Funding.html#Funding">Funding</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Header-Dirs.html#Header-Dirs">Header Dirs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="index.html#Top">Top</a>
<hr>
</div>

<h2 class="chapter">22 Memory Management and Type Information</h2>

<p><a name="index-GGC-4775"></a><a name="index-GTY-4776"></a>
GCC使用了一些相当复杂微妙的内存管理技术，包括从GCC源代码中确定GCC的
数据结构的信息，并使用该信息来执行垃圾收集和实现预编译头文件。

 <p>使用完整的C解析器来完成这项工作会非常复杂，因此只解析C的有限子集，
并且使用特定的标记来确定源代码的哪些部分需要分析。所有的
<code>struct</code> 和 <code>union</code> 声明，如果所定义的数据结构要在垃圾收集
器的控制下进行分配，则必须被标记。所有的全局变量，如果所保存的指针是
指向垃圾收集的内存，则也必须被标记。最后，所有的全局变量，如果需要通
过预编译头文件来保存和恢复，则必须被标记。（预编译头文件机制只能保存
标量，复杂的数据结构必须被分配在垃圾收集内存中，从而被保存在预编译头
文件中。）

 <p>标记的完整格式是

<pre class="smallexample">     GTY (([<var>option</var>] [(<var>param</var>)], [<var>option</var>] [(<var>param</var>)] ...))
</pre>
 <p class="noindent">不过大多数情况下，不需要选项。虽然这样，外面的双括号依然是必须的：
<code>GTY(())</code>。标记可以出现在：

     <ul>
<li>在结构体定义中，放在开括号之前；
<li>在全局变量声明中，放在关键词 <code>static</code> 或者 <code>extern</code> 之后；
<li>在结构体的域的定义里，在域的名字之前。
</ul>

 <p>这里有一些标记简单数据结构和全局变量的例子。

<pre class="smallexample">     struct <var>tag</var> GTY(())
     {
       <var>fields</var>...
     };
     
     typedef struct <var>tag</var> GTY(())
     {
       <var>fields</var>...
     } *<var>typename</var>;
     
     static GTY(()) struct <var>tag</var> *<var>list</var>;   /* <span class="roman">points to GC memory</span> */
     static GTY(()) int <var>counter</var>;        /* <span class="roman">save counter in a PCH</span> */
</pre>
 <p>解析器能够理解简单的typedef，例如
<code>typedef struct </code><var>tag</var><code> *</code><var>name</var><code>;</code> 和
<code>typedef int </code><var>name</var><code>;</code>。这些不需要被标记。

<ul class="menu">
<li><a accesskey="1" href="GTY-Options.html#GTY-Options">GTY Options</a>:          <code>GTY(())</code> 的内部。
<li><a accesskey="2" href="GGC-Roots.html#GGC-Roots">GGC Roots</a>:            标记全局变量GGC roots。
<li><a accesskey="3" href="Files.html#Files">Files</a>:                生成的文件如何工作。
<li><a accesskey="4" href="Invoking-the-garbage-collector.html#Invoking-the-garbage-collector">Invoking the garbage collector</a>:    如何调用垃圾收集器。
</ul>

 </body></html>

