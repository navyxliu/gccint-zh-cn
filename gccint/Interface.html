<html lang="en">
<head>
<title>Interface - GNU Compiler Collection (GCC) Internals</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Compiler Collection (GCC) Internals">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="prev" href="Portability.html#Portability" title="Portability">
<link rel="next" href="Libgcc.html#Libgcc" title="Libgcc">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,
1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007,
2008, 2010 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``Funding Free Software'', the Front-Cover
Texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.

(a) The FSF's 封面文字为:

     GNU手册

(b) The FSF's Back-Cover Text is:

     你有复制和修改本GNU手册的自由，如同你拥有的GNU软件的自由一样。FSF出版此拷贝的收入用于资助GNU发展。-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Interface"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Libgcc.html#Libgcc">Libgcc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Portability.html#Portability">Portability</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="index.html#Top">Top</a>
<hr>
</div>

<h2 class="chapter">3 GCC的输出接口（output interface）</h2>

<p><a name="index-interfacing-to-GCC-output-7"></a><a name="index-run_002dtime-conventions-8"></a><a name="index-function-call-conventions-9"></a><a name="index-conventions_002c-run_002dtime-10"></a>
GCC通常被配置为使用目标平台系统默认的函数调用规范（function calling convention）。
这通过机器描述相应的宏（machine-description macros）来描述(see <a href="Target-Macros.html#Target-Macros">Target Macros</a>)。

 <p><a name="index-unions_002c-returning-11"></a><a name="index-structures_002c-returning-12"></a><a name="index-returning-structures-and-unions-13"></a>
然而，在一些目标平台上，使用了不同的方法来处理结构体（struct）和联合体（union）的返回问题。
由此带来的一个结果是PCC和GCC编译的返回这类类型的函数无法相互调用。
这个问题不大，因为极少有Unix函数库例程（routine）返回这类类型。

 <p>对于长度为1、2、4、8字节的结构体/联合体，GCC通过跟 <code>int</code> 或 <code>double</code>
一样的寄存器返回。对于别的大小的结构体/联合体，GCC会把它存储在一个调用函数传递过来的（内存）地址中
（这个地址一般都是存在寄存器中），目标机使用钩子（hook） <code>TARGET_STRUCT_VALUE_RTX</code>
来告诉GCC如何传递这个内存地址。

 <p>相反，绝大多数平台上的PCC是这么做的：为结构体/联合体类型的函数返回值开辟一个静态存储区，
然后被调用函数（callee）把结果复制到静态存储区中，调用函数（caller）从静态区复制过来。
这样做一来比GCC的方法效率低，二来不能重入。

 <p>在RISC、80386等一些目标机上，标准的调用规范是传递返回值的地址。
当（平台默认）使用这种方法时，GCC被设置成和这些平台上标准编译器（standard compiler）一致。
这可能和前面说的长度为1、2、4、8字节的结构体/联合体返回方式不兼容。

 <p><a name="index-argument-passing-14"></a><a name="index-passing-arguments-15"></a>GCC使用系统的标准规范（standard convention）传递参数。
在一些平台上，前几个参数是放在寄存器里面的，其余放在栈上。
在所有平台上都使用寄存传递所有的参数是可能的，而且会带来速度提升。
但这样就可能无法保证和使用标准规范的程序兼容了。
所以只有当你把GCC当成这个系统唯一的C编译器的时候才可行。
我们可能会在那些已经支持了全套GNU系统的平台上使用（全）寄存器参数传递，
因为这个时候我们可以用GCC来编译系统库。

 <p>另外一些平台（特别是SPARC），特定类型的参数通过&ldquo;invisible reference&rdquo;传递。
这意味着参数值存在内存中，地址传递给被调用函数（subroutine）。

 <p><a name="index-g_t_0040code_007blongjmp_007d-and-automatic-variables-16"></a>如果你要使用 <code>longjmp</code>, 小心自动变量（automatic variables）。
ISO C 中定义没有声明为 <code>volatile</code> 的自动变量在 <code>longjmp</code> 之后的值
是未定义（undefine）的。这也是GCC承诺的做法，因为正确的存储寄存器变量难度太大。
而且GCC的一个特性（feature）就是自动把变量放到寄存器中，即使你（被编译的代码）没有指定。

<!-- Copyright (C) 2003, 2004, 2005, 2006, 2007 Free Software Foundation, Inc. -->
<!-- This is part of the GCC manual. -->
<!-- For copying conditions, see the file gcc.texi. -->
<!-- Contributed by Aldy Hernandez <aldy@quesejoda.com> -->
 </body></html>

