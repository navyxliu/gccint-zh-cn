<html lang="zh">
<head>
<title>机器模式切换 - GNU Compiler Collection (GCC) Internals</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Compiler Collection (GCC) Internals">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="_00e7_009b_00ae_00e6_00a0_0087_00e5_00ae_008f.html#g_t_00e7_009b_00ae_00e6_00a0_0087_00e5_00ae_008f" title="目标宏">
<link rel="prev" href="_00e6_00b5_00ae_00e7_0082_00b9.html#g_t_00e6_00b5_00ae_00e7_0082_00b9" title="浮点">
<link rel="next" href="_00e7_009b_00ae_00e6_00a0_0087_00e6_009c_00ba_00e5_00b1_009e_00e6_0080_00a7.html#g_t_00e7_009b_00ae_00e6_00a0_0087_00e6_009c_00ba_00e5_00b1_009e_00e6_0080_00a7" title="目标机属性">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
版权 (C) 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,
1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008 自由软件基金会

您可以依据自由软件基金会所发行的GNU自由文档授权1.2版本或者之后的任何版本，
对本文档进行复制，分发和/或修改；其中不可变章节为"资助自由软件"，封面文
字为 (a) (参见下面)，以及封底文字为 (b) (参见下面)。授权的副本要被包含在
标题为"GNU自由文档授权"的章节中。

(a) FSF的封面文字为：

     GNU 手册

(b) FSF的封底文字为：

     您可以自由复制和修改本GNU手册，如同GNU软件。由自由软件基金会所发行
     的副本用于为GNU开发筹集资金。-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="%e6%9c%ba%e5%99%a8%e6%a8%a1%e5%bc%8f%e5%88%87%e6%8d%a2"></a>
<a name="g_t_00e6_009c_00ba_00e5_0099_00a8_00e6_00a8_00a1_00e5_00bc_008f_00e5_0088_0087_00e6_008d_00a2"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="_00e7_009b_00ae_00e6_00a0_0087_00e6_009c_00ba_00e5_00b1_009e_00e6_0080_00a7.html#g_t_00e7_009b_00ae_00e6_00a0_0087_00e6_009c_00ba_00e5_00b1_009e_00e6_0080_00a7">目标机属性</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="_00e6_00b5_00ae_00e7_0082_00b9.html#g_t_00e6_00b5_00ae_00e7_0082_00b9">浮点</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="_00e7_009b_00ae_00e6_00a0_0087_00e5_00ae_008f.html#g_t_00e7_009b_00ae_00e6_00a0_0087_00e5_00ae_008f">目标宏</a>
<hr>
</div>

<h3 class="section">17.24 机器模式切换指令</h3>

<p><a name="index-mode-switching-4565"></a>下列的宏用来控制模式切换优化：

<div class="defun">
&mdash; Macro: <b>OPTIMIZE_MODE_SWITCHING</b> (<var>entity</var>)<var><a name="index-OPTIMIZE_005fMODE_005fSWITCHING-4566"></a></var><br>
<blockquote><p>定义该宏，如果在优化编译中，port需要为机器模式切换插入额外的指令。

      <p>例如，SH4可以执行单精度和双精度的浮点运算，但是执行单精度运算时，
必须清除FPSCR PR位，而执行双精度运算时，必须设置该位。
改变PR位需要一个通用寄存器来作为草稿寄存器，
因此这些FPSCR设置必须在重载之前被插入，
即你不能将它放在指令输出或者<code>TARGET_MACHINE_DEPENDENT_REORG</code>阶段。

      <p>你可以具有多个具有模式切换的实体，并且在运行时选择哪些实体实际需要。
对于任何需要模式切换的<var>entity</var>，<code>OPTIMIZE_MODE_SWITCHING</code>应该返回非零。
如果你定义了该宏，你还必须定义<code>NUM_MODES_FOR_MODE_SWITCHING</code>,
<code>MODE_NEEDED</code>, <code>MODE_PRIORITY_TO_MODE</code>和<code>EMIT_MODE_SET</code>。
<code>MODE_AFTER</code>, <code>MODE_ENTRY</code>和<code>MODE_EXIT</code>是可选的。
</p></blockquote></div>

<div class="defun">
&mdash; Macro: <b>NUM_MODES_FOR_MODE_SWITCHING</b><var><a name="index-NUM_005fMODES_005fFOR_005fMODE_005fSWITCHING-4567"></a></var><br>
<blockquote><p>如果你定义了<code>OPTIMIZE_MODE_SWITCHING</code>，你必须定义该宏，
作为整数数组的初始化。每个初始化元素N引用一个需要模式切换的实体，
并且指定了该实体可能需要被设置的不同模式的数目。
初始化的位置——起始于0——确定了被用于引用有问题的模式切换实体的整数。
</p></blockquote></div>

<div class="defun">
&mdash; Macro: <b>MODE_NEEDED</b> (<var>entity, insn</var>)<var><a name="index-MODE_005fNEEDED-4568"></a></var><br>
<blockquote><p><var>entity</var>为一个整数指定了模式切换的实体。
如果定义了<code>OPTIMIZE_MODE_SWITCHING</code>，
则必须定义该宏来返回一个不大于在<code>NUM_MODES_FOR_MODE_SWITCHING</code>
中相应元素的整数值，来指示<var>entity</var>在执行<var>insn</var>前必须被切换成的模式。
</p></blockquote></div>

<div class="defun">
&mdash; Macro: <b>MODE_AFTER</b> (<var>mode, insn</var>)<var><a name="index-MODE_005fAFTER-4569"></a></var><br>
<blockquote><p>如果定义该宏，其在模式切换过程中对于每个<var>insn</var>进行求值。
其确定一个insn的结果时的模式（如果与输入时的模式不同）。
</p></blockquote></div>

<div class="defun">
&mdash; Macro: <b>MODE_ENTRY</b> (<var>entity</var>)<var><a name="index-MODE_005fENTRY-4570"></a></var><br>
<blockquote><p>如果定义该宏，其对每个需要模式切换的<var>entity</var>进行求值。
结果为一个整数，为<var>entity</var>在函数入口处被假定切换成的模式。
如果定义了<code>MODE_ENTRY</code>，则必须定义<code>MODE_EXIT</code>。
</p></blockquote></div>

<div class="defun">
&mdash; Macro: <b>MODE_EXIT</b> (<var>entity</var>)<var><a name="index-MODE_005fEXIT-4571"></a></var><br>
<blockquote><p>如果定义该宏，其对每个需要模式切换的实体进行求值。结果为一个整数，
为实体在函数出口处被假定切换成的模式。如果定义了<code>MODE_EXIT</code>，
则必须定义<code>MODE_ENTRY</code>。
</p></blockquote></div>

<div class="defun">
&mdash; Macro: <b>MODE_PRIORITY_TO_MODE</b> (<var>entity, n</var>)<var><a name="index-MODE_005fPRIORITY_005fTO_005fMODE-4572"></a></var><br>
<blockquote><p>该宏指定了被处理的<var>entity</var>的模式顺序。0为最高优先级，
<code>NUM_MODES_FOR_MODE_SWITCHING[</code><var>entity</var><code>] - 1</code>为最低。
宏的值应该为一个整数，表示<var>entity</var>的一个模式。对于任何固定的<var>entity</var>，
<code>mode_priority_to_mode</code>(<var>entity</var>, <var>n</var>))应该为0<small class="dots">...</small>
<code>num_modes_for_mode_switching[</code><var>entity</var><code>] - 1</code>之间的双向影射。
</p></blockquote></div>

<div class="defun">
&mdash; Macro: <b>EMIT_MODE_SET</b> (<var>entity, mode, hard_regs_live</var>)<var><a name="index-EMIT_005fMODE_005fSET-4573"></a></var><br>
<blockquote><p>生成一个或多个insn来将<var>entity</var>设为<var>mode</var>。
<var>hard_reg_live</var>是在insn被插入点处的硬件寄存器活跃集。
</p></blockquote></div>

 </body></html>

