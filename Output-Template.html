<html lang="zh">
<head>
<title>Output Template - GNU Compiler Collection (GCC) Internals</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="GNU Compiler Collection (GCC) Internals">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Machine-Desc.html#Machine-Desc" title="Machine Desc">
<link rel="prev" href="RTL-Template.html#RTL-Template" title="RTL Template">
<link rel="next" href="Output-Statement.html#Output-Statement" title="Output Statement">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
版权 (C) 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,
1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2010 自由软件基金会

您可以依据自由软件基金会所发行的GNU自由文档授权1.3版本或者之后的任何版本，对本文档进行复制，分发和/或修改；其中不可变章节为"资助自由软件"，封面文字为 (a) (参见下面)，以及封底文字为 (b) (参见下面)。授权的副本要被包含在标题为"GNU自由文档授权"的章节中。

(a) FSF的封面文字为：

     GNU 手册

(b) FSF的封底文字为：

     您可以自由复制和修改本GNU手册，如同GNU软件。由自由软件基金会所发行的副本用于为GNU开发筹集资金。-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Output-Template"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Output-Statement.html#Output-Statement">Output Statement</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="RTL-Template.html#RTL-Template">RTL Template</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Machine-Desc.html#Machine-Desc">Machine Desc</a>
<hr>
</div>

<h3 class="section">16.5 输出模板和操作数替换</h3>

<p><a name="index-output-templates-3224"></a><a name="index-operand-substitution-3225"></a>
<!-- @cindex @samp{%} in template -->
<!-- @cindex percent sign -->
<!-- The @dfn{output template} is a string which specifies how to output the -->
<!-- assembler code for an instruction pattern.  Most of the template is a -->
<!-- fixed string which is output literally.  The character @samp{%} is used -->
<!-- to specify where to substitute an operand; it can also be used to -->
<!-- identify places where different variants of the assembler require -->
<!-- different syntax. -->
<a name="index-g_t_0040samp_007b_0025_007d-in-template-3226"></a><a name="index-percent-sign-3227"></a><dfn>output template</dfn>是一个字符串，其指定了如何为一个指令模式输出汇编代码。
大多数模板都是一个固定的字符串，可以按照字面直接输出。符号 &lsquo;<samp><span class="samp">%</span></samp>&rsquo; 用来指
定替换操作数；

<!-- In the simplest case, a @samp{%} followed by a digit @var{n} says to output -->
<!-- operand @var{n} at that point in the string. -->
 <p>最简单的情况下，一个 &lsquo;<samp><span class="samp">%</span></samp>&rsquo; 后面跟一个数字 <var>n</var> 表示在字符串中的这个
位置输出操作数 <var>n</var>。

<!-- @samp{%} followed by a letter and a digit says to output an operand in an -->
<!-- alternate fashion.  Four letters have standard, built-in meanings described -->
<!-- below.  The machine description macro @code{PRINT_OPERAND} can define -->
<!-- additional letters with nonstandard meanings. -->
 <p>&lsquo;<samp><span class="samp">%</span></samp>&rsquo; 后面跟一个字母和一个数字表示用备用方式来输出操作数。有四个字母具
有标准内嵌的含义，将在下面描述。机器描述宏 <code>PRINT_OPERAND</code> 能够定义
其它的非标准含义的字母。

<!-- @samp{%c@var{digit}} can be used to substitute an operand that is a -->
<!-- constant value without the syntax that normally indicates an immediate -->
<!-- operand. -->
 <p>&lsquo;<samp><span class="samp">%c</span><var>digit</var></samp>&rsquo; 可以用来替换一个常数值的操作数。

<!-- @samp{%n@var{digit}} is like @samp{%c@var{digit}} except that the value of -->
<!-- the constant is negated before printing. -->
 <p>&lsquo;<samp><span class="samp">%n</span><var>digit</var></samp>&rsquo; 类似于 &lsquo;<samp><span class="samp">%c</span><var>digit</var></samp>&rsquo;，只不过是对要打印的常数
值进行取反操作（negated）。

<!-- @samp{%a@var{digit}} can be used to substitute an operand as if it were a -->
<!-- memory reference, with the actual operand treated as the address.  This may -->
<!-- be useful when outputting a ``load address'' instruction, because often the -->
<!-- assembler syntax for such an instruction requires you to write the operand -->
<!-- as if it were a memory reference. -->
 <p>&lsquo;<samp><span class="samp">%a</span><var>digit</var></samp>&rsquo; 可以用来替换一个操作数，并把它当作一个内存引用，实际
的操作数则被视为地址。这在输出一个加载地址的指令时很有帮助，因为对于这样
的指令，汇编器语法经常需要你将操作数写成一个内存引用的形式。

<!-- @samp{%l@var{digit}} is used to substitute a @code{label_ref} into a jump -->
<!-- instruction. -->
 <p>&lsquo;<samp><span class="samp">%l</span><var>digit</var></samp>&rsquo; 用来将一个 <code>label_ref</code> 替换到跳转指令中。

<!-- @samp{%=} outputs a number which is unique to each instruction in the -->
<!-- entire compilation.  This is useful for making local labels to be -->
<!-- referred to more than once in a single template that generates multiple -->
<!-- assembler instructions. -->
 <p>&lsquo;<samp><span class="samp">%=</span></samp>&rsquo; 输出一个在整个编译过程中，对每一条指令都是唯一的编号。这可以用来
在一个生成多个汇编指令的单一模板中， 使得局部标号能够被多次引用。

<!-- @samp{%} followed by a punctuation character specifies a substitution that -->
<!-- does not use an operand.  Only one case is standard: @samp{%%} outputs a -->
<!-- @samp{%} into the assembler code.  Other nonstandard cases can be -->
<!-- defined in the @code{PRINT_OPERAND} macro.  You must also define -->
<!-- which punctuation characters are valid with the -->
<!-- @code{PRINT_OPERAND_PUNCT_VALID_P} macro. -->
 <p>&lsquo;<samp><span class="samp">%</span></samp>&rsquo; 后面跟一个标点符号指定了一个不使用操作数的替换。只用一种情况是标
准的：&lsquo;<samp><span class="samp">%%</span></samp>&rsquo; 用来输出一个 &lsquo;<samp><span class="samp">%</span></samp>&rsquo; 到汇编代码中。其它非标准的情况可以被
定义在 <code>PRINT_OPERAND</code> 宏中。你必须还要通过宏
<code>PRINT_OPERAND_PUNCT_VALID_P</code> 来定义哪些标点符号是有效的。

<!-- @cindex \ -->
<!-- @cindex backslash -->
<!-- The template may generate multiple assembler instructions.  Write the text -->
<!-- for the instructions, with @samp{\;} between them. -->
 <p><a name="index-g_t_005c-3228"></a><a name="index-backslash-3229"></a>模板可以生成多条汇编指令。这些指令文本之间使用 &lsquo;<samp><span class="samp">\;</span></samp>&rsquo; 隔开。

<!-- @cindex matching operands -->
<!-- When the RTL contains two operands which are required by constraint to match -->
<!-- each other, the output template must refer only to the lower-numbered operand. -->
<!-- Matching operands are not always identical, and the rest of the compiler -->
<!-- arranges to put the proper RTL expression for printing into the lower-numbered -->
<!-- operand. -->
 <p><a name="index-matching-operands-3230"></a>‘%’之后跟非标准字母或者标点符号的一种用途是区分同一机器的不同汇编语言；例如，68000的Motorola语法和MIT语法。 Motorola语法要求大多数的操作名都含有句点，而MIT语法中没有。比如，MIT语法中的操作码‘movel’在Motorola语法中为 ‘move.l’。两种输出法语使用了同一个模式文件，只不过在Motorola语法需要句点的地方使用了字符序列‘%.’。Motorola语法的宏 PRINT_OPERAND定义了这个序列用于输出一个句点；MIT语法的宏将其定义为不做任何事情。

<!-- One use of nonstandard letters or punctuation following @samp{%} is to -->
<!-- distinguish between different assembler languages for the same machine; for -->
<!-- example, Motorola syntax versus MIT syntax for the 68000.  Motorola syntax -->
<!-- requires periods in most opcode names, while MIT syntax does not.  For -->
<!-- example, the opcode @samp{movel} in MIT syntax is @samp{move.l} in Motorola -->
<!-- syntax.  The same file of patterns is used for both kinds of output syntax, -->
<!-- but the character sequence @samp{%.} is used in each place where Motorola -->
<!-- syntax wants a period.  The @code{PRINT_OPERAND} macro for Motorola syntax -->
<!-- defines the sequence to output a period; the macro for MIT syntax defines -->
<!-- it to do nothing. -->
 <p>紧随&lsquo;<samp><span class="samp">%</span></samp>&rsquo;之后的非标准字母或者标点符号的一种用法是，为同一机器区别不同的汇编语言；例如，68000的Motorola语法与MIT语法。Motorola语法要求大多操作码的名字中带有句号，而MIT语法不是这样。例如，在MIT语法中的操作码&lsquo;<samp><span class="samp">movel</span></samp>&rsquo;，在Motorola语法中为&lsquo;<samp><span class="samp">move.l</span></samp>&rsquo;。这两种输出语法都在同一个文件中的指令模式中实现，只不过字符序列&lsquo;<samp><span class="samp">%.</span></samp>&rsquo;用在需要句号的Motorola语法中。Motorola语法的<code>PRINT_OPERAND</code>宏，将该序列定义成输出一个句号；而MIT语法则将其定义为不做任何事情。

<!-- @cindex @code{#} in template -->
<!-- As a special case, a template consisting of the single character @code{#} -->
<!-- instructs the compiler to first split the insn, and then output the -->
<!-- resulting instructions separately.  This helps eliminate redundancy in the -->
<!-- output templates.   If you have a @code{define_insn} that needs to emit -->
<!-- multiple assembler instructions, and there is a matching @code{define_split} -->
<!-- already defined, then you can simply use @code{#} as the output template -->
<!-- instead of writing an output template that emits the multiple assembler -->
<!-- instructions. -->
 <p><a name="index-g_t_0040code_007b_0023_007d-in-template-3231"></a>作为一种特殊情况，只包含一个单独的字符#的模板会指示编译器首先拆分insn，然后分别输出所得的指令。这样有助于减少输出模板的重复内容。如果你有一个<code>define_insn</code>，其需要输出多个汇编指令，并且有一个匹配的<code>define_split</code>已经被定义，则你可以简单的使用#作为输出模板，而不用将模板写成输出多个汇编指令的样子。

<!-- If the macro @code{ASSEMBLER_DIALECT} is defined, you can use construct -->
<!-- of the form @samp{@{option0|option1|option2@}} in the templates.  These -->
<!-- describe multiple variants of assembler language syntax. -->
<!-- @xref{Instruction Output}. -->
 <p>如果宏<code>ASSEMBLER_DIALECT</code>被定义，你可以在模板中使用形如&lsquo;<samp><span class="samp">{option0|option1|option2}</span></samp>&rsquo;的结构。这些描述了多个汇编语言语法的变体。参见<a href="Instruction-Output.html#Instruction-Output">Instruction Output</a>。

<!-- @node Output Statement -->
<!-- @section C Statements for Assembler Output -->
<!-- @cindex output statements -->
<!-- @cindex C statements for assembler output -->
<!-- @cindex generating assembler output -->
<!-- Often a single fixed template string cannot produce correct and efficient -->
<!-- assembler code for all the cases that are recognized by a single -->
<!-- instruction pattern.  For example, the opcodes may depend on the kinds of -->
<!-- operands; or some unfortunate combinations of operands may require extra -->
<!-- machine instructions. -->
 </body></html>

