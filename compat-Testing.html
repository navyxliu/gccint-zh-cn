<html lang="zh">
<head>
<title>compat Testing - GNU Compiler Collection (GCC) Internals</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="GNU Compiler Collection (GCC) Internals">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Testsuites.html#Testsuites" title="Testsuites">
<link rel="prev" href="profopt-Testing.html#profopt-Testing" title="profopt Testing">
<link rel="next" href="Torture-Tests.html#Torture-Tests" title="Torture Tests">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
版权 (C) 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,
1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2010 自由软件基金会

您可以依据自由软件基金会所发行的GNU自由文档授权1.3版本或者之后的任何版本，对本文档进行复制，分发和/或修改；其中不可变章节为"资助自由软件"，封面文字为 (a) (参见下面)，以及封底文字为 (b) (参见下面)。授权的副本要被包含在标题为"GNU自由文档授权"的章节中。

(a) FSF的封面文字为：

     GNU 手册

(b) FSF的封底文字为：

     您可以自由复制和修改本GNU手册，如同GNU软件。由自由软件基金会所发行的副本用于为GNU开发筹集资金。-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="compat-Testing"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Torture-Tests.html#Torture-Tests">Torture Tests</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="profopt-Testing.html#profopt-Testing">profopt Testing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Testsuites.html#Testsuites">Testsuites</a>
<hr>
</div>

<h3 class="section">7.9 对二进制兼容性测试的支持</h3>

<!-- The file @file{compat.exp} provides language-independent support for -->
<!-- binary compatibility testing.  It supports testing interoperability of -->
<!-- two compilers that follow the same ABI, or of multiple sets of -->
<!-- compiler options that should not affect binary compatibility.  It is -->
<!-- intended to be used for testsuites that complement ABI testsuites. -->
<p>文件<samp><span class="file">compat.exp</span></samp>提供了对二进制兼容性测试的语言无关的支持。它支持测试遵循相同ABI的两个编译器，或者编译器选项的多个集合，在一起工作时不影响二进制兼容性。它是打算用来补充ABI测试包的。

<!-- A test supported by this framework has three parts, each in a -->
<!-- separate source file: a main program and two pieces that interact -->
<!-- with each other to split up the functionality being tested. -->
 <p>该框架支持的测试具有三部分，分别在不同的源文件中：主程序，和两个相互作用来拆分要测试的功能的部分。

     <dl>
<dt><samp><var>testname</var><span class="file">_main.</span><var>suffix</var></samp><dd><!-- Contains the main program, which calls a function in file -->
<!-- @file{@var{testname}_x.@var{suffix}}. -->
包含了主程序，其调用了文件<samp><var>testname</var><span class="file">_x.</span><var>suffix</var></samp>中的函数。

     <br><dt><samp><var>testname</var><span class="file">_x.</span><var>suffix</var></samp><dd><!-- Contains at least one call to a function in -->
<!-- @file{@var{testname}_y.@var{suffix}}. -->
包含了至少一个对<samp><var>testname</var><span class="file">_y.</span><var>suffix</var></samp>中的函数的调用。

     <br><dt><samp><var>testname</var><span class="file">_y.</span><var>suffix</var></samp><dd><!-- Shares data with, or gets arguments from, -->
<!-- @file{@var{testname}_x.@var{suffix}}. -->
与<samp><var>testname</var><span class="file">_x.</span><var>suffix</var></samp>共享数据，或者从中获得参数。
</dl>

<!-- Within each test, the main program and one functional piece are -->
<!-- compiled by the GCC under test.  The other piece can be compiled by -->
<!-- an alternate compiler.  If no alternate compiler is specified, -->
<!-- then all three source files are all compiled by the GCC under test. -->
<!-- You can specify pairs of sets of compiler options.  The first element -->
<!-- of such a pair specifies options used with the GCC under test, and the -->
<!-- second element of the pair specifies options used with the alternate -->
<!-- compiler.  Each test is compiled with each pair of options. -->
 <p>每个测试中，主程序和一个功能部分由测试GCC编译。另一部分可以由一个候选编译器来编译。如果没有指定候选编译器，则所有的这三个源文件都由测试 GCC编译。你可以指定一个编译器选项对。每一对中第一个元素指定了测试GCC使用的选项，第二个元素用于候选编译器。每个测试都是用这些选项来编译。

<!-- @file{compat.exp} defines default pairs of compiler options. -->
<!-- These can be overridden by defining the environment variable -->
<!-- @env{COMPAT_OPTIONS} as: -->
 <p><samp><span class="file">compat.exp</span></samp>定义了缺省的一对编译器选项。这些可以通过定义环境变量<samp><span class="env">COMPAT_OPTIONS</span></samp>来取代，如：

<pre class="smallexample">     COMPAT_OPTIONS="[list [list {<var>tst1</var>} {<var>alt1</var>}]
       ...[list {<var>tstn</var>} {<var>altn</var>}]]"
</pre>
 <!-- where @var{tsti} and @var{alti} are lists of options, with @var{tsti} -->
<!-- used by the compiler under test and @var{alti} used by the alternate -->
<!-- compiler.  For example, with -->
<!-- @code{[list [list @{-g -O0@} @{-O3@}] [list @{-fpic@} @{-fPIC -O2@}]]}, -->
<!-- the test is first built with @option{-g -O0} by the compiler under -->
<!-- test and with @option{-O3} by the alternate compiler.  The test is -->
<!-- built a second time using @option{-fpic} by the compiler under test -->
<!-- and @option{-fPIC -O2} by the alternate compiler. -->
 <p>其中<var>tsti</var>和<var>alti</var>是选项列表，要测试的编译器使用<var>tsti</var>，候选的编译器使用<var>alti</var>。例如，对于<code>[list [list {-g -O0} {-O3}] [list {-fpic} {-fPIC -O2}]]</code>，测试会首先被要测试的编译器使用<samp><span class="option">-g -O0</span></samp>来编译，并且被候选编译器使用<samp><span class="option">-O3</span></samp>来编译。测试在第二次的时候，测试编译器会使用<samp><span class="option">-fpic</span></samp>，候选编译器会使用<samp><span class="option">-fPIC -O2</span></samp>。

<!-- An alternate compiler is specified by defining an environment -->
<!-- variable to be the full pathname of an installed compiler; for C -->
<!-- define @env{ALT_CC_UNDER_TEST}, and for C++ define -->
<!-- @env{ALT_CXX_UNDER_TEST}.  These will be written to the -->
<!-- @file{site.exp} file used by DejaGnu.  The default is to build each -->
<!-- test with the compiler under test using the first of each pair of -->
<!-- compiler options from @env{COMPAT_OPTIONS}.  When -->
<!-- @env{ALT_CC_UNDER_TEST} or -->
<!-- @env{ALT_CXX_UNDER_TEST} is @code{same}, each test is built using -->
<!-- the compiler under test but with combinations of the options from -->
<!-- @env{COMPAT_OPTIONS}. -->
 <p>候选编译器通过将环境变量定义为安装的编译的全路径名来指定；对于C，定义<samp><span class="env">ALT_CC_UNDER_TEST</span></samp>，对于C++，定义<samp><span class="env">ALT_CXX_UNDER_TEST</span></samp>。这些将被写入DejaGnu使用的<samp><span class="file">site.exp</span></samp>文件中。缺省情况，是由要测试的编译器，使用<samp><span class="env">COMPAT_OPTIONS</span></samp>中每个编译选项对的第一个，来构建每个测试。当<samp><span class="env">ALT_CC_UNDER_TEST</span></samp>或<samp><span class="env">ALT_CXX_UNDER_TEST</span></samp>为<code>same</code>时，每个测试将使用测试编译来构建，但是使用<samp><span class="env">COMPAT_OPTIONS</span></samp>中的选项组合。

<!-- To run only the C++ compatibility suite using the compiler under test -->
<!-- and another version of GCC using specific compiler options, do the -->
<!-- following from @file{@var{objdir}/gcc}: -->
 <p>若要对要测试的编译器和另一版本的使用指定编译选项的GCC，只运行C++兼容性测试包，则在<samp><var>objdir</var><span class="file">/gcc</span></samp>下执行下列命令：

<pre class="smallexample">     rm site.exp
     make -k \
       ALT_CXX_UNDER_TEST=${alt_prefix}/bin/g++ \
       COMPAT_OPTIONS="<var>lists as shown above</var>" \
       check-c++ \
       RUNTESTFLAGS="compat.exp"
</pre>
 <!-- A test that fails when the source files are compiled with different -->
<!-- compilers, but passes when the files are compiled with the same -->
<!-- compiler, demonstrates incompatibility of the generated code or -->
<!-- runtime support.  A test that fails for the alternate compiler but -->
<!-- passes for the compiler under test probably tests for a bug that was -->
<!-- fixed in the compiler under test but is present in the alternate -->
<!-- compiler. -->
 <p>如果一个测试当源文件由不同编译器编译的时候执行失败，而当文件由同一编译器编译的时候执行成功，则表明生成代码或运行时支持不兼容。如果一个测试对于候选编译器执行失败，但对于测试编译器却执行成功，则可能是因为一个bug在测试编译器中已经被修改好，但还存在于候选编译器中。

<!-- The binary compatibility tests support a small number of test framework -->
<!-- commands that appear within comments in a test file. -->
 <p>二进制兼容性测试支持少数在测试文件的注释中出现的测试框架命令。

     <dl>
<dt><code>dg-require-*</code><dd><!-- These commands can be used in @file{@var{testname}_main.@var{suffix}} -->
<!-- to skip the test if specific support is not available on the target. -->
这些命令可以用于<samp><var>testname</var><span class="file">_main.</span><var>suffix</var></samp>中，使得当目标机上没有特定支持的时候跳过测试。

     <br><dt><code>dg-options</code><dd><!-- The specified options are used for compiling this particular source -->
<!-- file, appended to the options from @env{COMPAT_OPTIONS}.  When this -->
<!-- command appears in @file{@var{testname}_main.@var{suffix}} the options -->
<!-- are also used to link the test program. -->
指定选项用于编译该特定的源文件，将选项添加到<samp><span class="env">COMPAT_OPTIONS</span></samp>中。当该命令出现在<samp><var>testname</var><span class="file">_main.</span><var>suffix</var></samp>中时，选项还用于链接测试程序的时候。

     <br><dt><code>dg-xfail-if</code><dd><!-- This command can be used in a secondary source file to specify that -->
<!-- compilation is expected to fail for particular options on particular -->
<!-- targets. -->
该命令可以用在第二个源文件中，来指定在特定目标机上对于特定选项，编译将会失败。
</dl>

<!-- @node Torture Tests -->
<!-- @section Support for torture testing using multiple options -->
 </body></html>

